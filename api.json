{
  "info": {
    "title": "CUZBSI REST API",
    "description": "Banking automation and transaction management API with real-time Socket.IO events",
    "version": "1.0.0",
    "baseUrl": "http://localhost:5543",
    "authentication": "JWT Bearer Token"
  },
  "socketEvents": [
    "connect",
    "disconnect", 
    "sync_started",
    "sync_progress",
    "sync_completed",
    "sync_error",
    "batch_sync_started",
    "batch_sync_progress", 
    "batch_sync_completed",
    "batch_sync_error",
    "automation_preview",
    "automation_preview_stopped",
    "heartbeat",
    "bank_login_progress"
  ],
  "endpoints": {
    "POST /api/auth/login": {
      "description": "Login with email and password",
      "body": {
        "email": "admin@multimutasi.com",
        "password": "admin123"
      },
      "response": {
        "success": true,
        "message": "Login successful",
        "data": {
          "user": {
            "id": 1,
            "email": "admin@multimutasi.com",
            "roles": ["admin"]
          },
          "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
          "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        }
      }
    },
    "GET /api/auth/info": {
      "description": "Get authentication endpoints info",
      "response": {
        "success": true,
        "message": "Authentication endpoints",
        "data": {
          "endpoints": {
            "login": "POST /api/auth/login",
            "refresh": "POST /api/auth/refresh", 
            "logout": "POST /api/auth/logout"
          }
        }
      }
    },
    "POST /api/auth/logout": {
      "description": "Logout current user",
      "headers": {
        "Authorization": "Bearer <token>"
      },
      "response": {
        "success": true,
        "message": "Logout successful"
      }
    },
    "GET /api/users": {
      "description": "Get all users (admin only)",
      "permissions": ["users.manage"],
      "params": {
        "page": 1,
        "limit": 10,
        "search": "optional"
      },
      "response": {
        "success": true,
        "message": "Users retrieved successfully",
        "data": {
          "users": [
            {
              "id": 1,
              "email": "admin@multimutasi.com", 
              "firstName": "Admin",
              "lastName": "User",
              "isActive": true,
              "Roles": [
                {
                  "id": 1,
                  "name": "admin",
                  "description": "Administrator role"
                }
              ]
            }
          ],
          "pagination": {
            "page": 1,
            "limit": 10,
            "total": 5,
            "totalPages": 1
          }
        }
      }
    },
    "POST /api/users": {
      "description": "Create new user (admin only)",
      "permissions": ["users.manage"],
      "body": {
        "email": "newuser@example.com",
        "password": "securepassword123",
        "firstName": "John",
        "lastName": "Doe",
        "roleIds": [1, 2]
      },
      "response": {
        "success": true,
        "message": "User created successfully",
        "data": {
          "user": {
            "id": 5,
            "email": "newuser@example.com",
            "firstName": "John", 
            "lastName": "Doe",
            "isActive": true,
            "Roles": [
              {
                "id": 1,
                "name": "admin",
                "description": "Administrator role"
              }
            ]
          }
        }
      }
    },
    "PUT /api/users/:id": {
      "description": "Update user (admin only)",
      "permissions": ["users.manage"],
      "body": {
        "email": "updated@example.com",
        "firstName": "Updated",
        "lastName": "User",
        "isActive": true,
        "roleIds": [1, 3]
      },
      "response": {
        "success": true,
        "message": "User updated successfully",
        "data": {
          "user": {
            "id": 5,
            "email": "updated@example.com",
            "firstName": "Updated",
            "lastName": "User",
            "isActive": true
          }
        }
      }
    },
    "DELETE /api/users/:id": {
      "description": "Deactivate user (admin only)",
      "permissions": ["users.manage"],
      "response": {
        "success": true,
        "message": "User deactivated successfully"
      }
    },
    "GET /api/roles": {
      "description": "Get all roles (admin only)",
      "permissions": ["users.manage"],
      "params": {
        "page": 1,
        "limit": 10,
        "search": "optional",
        "includeUsers": "true/false"
      },
      "response": {
        "success": true,
        "message": "Roles retrieved successfully", 
        "data": {
          "roles": [
            {
              "id": 1,
              "name": "admin",
              "description": "Administrator role",
              "Permissions": [
                {
                  "id": 1,
                  "name": "users.manage",
                  "description": "Manage users and roles"
                }
              ]
            }
          ]
        }
      }
    },
    "POST /api/roles": {
      "description": "Create new role (admin only)",
      "permissions": ["users.manage"],
      "body": {
        "name": "manager",
        "description": "Manager role",
        "permissionIds": [1, 2, 3]
      },
      "response": {
        "success": true,
        "message": "Role created successfully",
        "data": {
          "role": {
            "id": 4,
            "name": "manager",
            "description": "Manager role",
            "Permissions": [
              {
                "id": 1,
                "name": "users.manage",
                "description": "Manage users and roles"
              }
            ]
          }
        }
      }
    },
    "GET /api/permissions": {
      "description": "Get all permissions (admin only)",
      "permissions": ["users.manage"],
      "response": {
        "success": true,
        "message": "Permissions retrieved successfully",
        "data": {
          "permissions": [
            {
              "id": 1,
              "name": "users.manage",
              "description": "Manage users and roles"
            },
            {
              "id": 2,
              "name": "banks.manage", 
              "description": "Manage bank configurations"
            }
          ]
        }
      }
    },
    "GET /api/dashboard": {
      "description": "Get dashboard statistics",
      "response": {
        "success": true,
        "message": "Dashboard data retrieved successfully",
        "data": {
          "stats": {
            "totalAccounts": 5,
            "activeAccounts": 4,
            "totalTransactions": 1247,
            "todayTransactions": 12,
            "flaggedTransactions": 89,
            "totalBalance": 12500000.00
          },
          "chartData": {
            "transactionDates": ["Mon", "Tue", "Wed", "Thu", "Fri"],
            "transactionCounts": [12, 19, 3, 5, 2]
          }
        }
      }
    },
     "GET /api/accounts": {
       "description": "Get user's bank accounts",
       "response": {
         "success": true,
         "message": "Accounts retrieved successfully",
         "data": {
           "accounts": [
             {
               "id": 4,
               "accountNumber": "61862171",
               "companyId": "0338",
               "isActive": true,
               "lastBalance": "1250000.00",
               "Bank": {
                 "name": "BSI",
                 "fullName": "Bank Syariah Indonesia"
               },
               "ScrapingOption": {
                 "isActive": true,
                 "cronExpression": "0 */6 * * *",
                 "lastStatus": "success"
               }
             }
           ]
         }
       }
     },
     "POST /api/accounts": {
       "description": "Create new bank account (admin only)",
       "permissions": ["accounts.manage"],
       "body": {
         "accountNumber": "1234567890123456",
         "companyId": "0338",
         "username": "bsi_username",
         "password": "secure_password",
         "bankId": 1,
         "autoSync": true,
         "isActive": true
       },
       "response": {
         "success": true,
         "message": "Account created successfully",
         "data": {
           "account": {
             "id": 5,
             "accountNumber": "1234567890123456",
             "companyId": "0338",
             "username": "bsi_username",
             "isActive": true,
             "Bank": {
               "name": "BSI",
               "fullName": "Bank Syariah Indonesia"
             }
           }
         }
       }
     },
     "PUT /api/accounts/:id": {
       "description": "Update bank account (admin only)",
       "permissions": ["accounts.manage"],
       "body": {
         "accountNumber": "1234567890123456",
         "companyId": "0338",
         "username": "bsi_username",
         "bankId": 1,
         "autoSync": true,
         "isActive": true
       },
       "response": {
         "success": true,
         "message": "Account updated successfully",
         "data": {
           "account": {
             "id": 5,
             "accountNumber": "1234567890123456",
             "companyId": "0338",
             "username": "bsi_username",
             "isActive": true
           }
         }
       }
     },
     "DELETE /api/accounts/:id": {
       "description": "Delete bank account (admin only)",
       "permissions": ["accounts.manage"],
       "response": {
         "success": true,
         "message": "Account deleted successfully"
       }
     },
    "GET /api/transactions": {
      "description": "Get transactions with filtering",
      "params": {
        "page": 1,
        "limit": 20,
        "accountId": "optional",
        "startDate": "YYYY-MM-DD",
        "endDate": "YYYY-MM-DD", 
        "type": "Debit/Kredit",
        "flag": "optional"
      },
      "response": {
        "success": true,
        "message": "Transactions retrieved successfully",
        "data": {
          "transactions": [
            {
              "id": 156,
              "tanggal": "2025-08-25T00:00:00.000Z",
              "description": "TRANSFER FROM ACC 1234567890",
              "Amount": "500000.00",
              "type": "Kredit",
              "Balance": "1750000.00",
              "flag": "income"
            }
          ],
          "pagination": {
            "page": 1,
            "limit": 20,
            "total": 156,
            "totalPages": 8
          }
        }
      }
    },
    "POST /api/transactions/:id/flag": {
      "description": "Flag a transaction",
      "body": {
        "flag": "income"
      },
      "response": {
        "success": true,
        "message": "Transaction flagged successfully"
      }
    },
    "GET /api/bsi/dashboard": {
      "description": "Get BSI automation dashboard",
      "response": {
        "success": true,
        "message": "Dashboard data retrieved successfully",
        "data": {
          "totalAccounts": 5,
          "activeAccounts": 4,
          "totalTransactions": 1247,
          "todayTransactions": 12
        }
      }
    },
    "POST /api/bsi/accounts/:accountId/sync": {
      "description": "Manual sync account with date range and preview",
      "params": {
        "startDate": "DD/MM/YYYY (e.g. 28/07/2025)",
        "endDate": "DD/MM/YYYY (e.g. 27/08/2025)",
        "enablePreview": "true/false"
      },
      "example": "POST /api/bsi/accounts/4/sync?startDate=28/07/2025&endDate=27/08/2025&enablePreview=true",
      "response": {
        "success": true,
        "message": "Sync started successfully",
        "data": {
          "syncId": "sync_4_1724752156",
          "accountId": 4,
          "socketRoom": "sync_sync_4_1724752156",
          "dateRange": {
            "startDate": "28/07/2025",
            "endDate": "27/08/2025"
          },
          "previewEnabled": true
        }
      },
      "error": {
        "success": false,
        "message": "Sync already in progress for account ID 4. Please wait for the current sync to complete."
      }
    },
    "POST /api/bsi/accounts/sync-all": {
      "description": "Sync all accounts with date range and preview",
      "params": {
        "startDate": "DD/MM/YYYY",
        "endDate": "DD/MM/YYYY",
        "enablePreview": "true/false"
      },
      "response": {
        "success": true,
        "message": "Started sequential syncing of 3 accounts",
        "data": {
          "syncId": "batch_sync_1724752156",
          "socketRoom": "sync_batch_sync_1724752156",
          "accountCount": 3,
          "accountIds": [1, 2, 3],
          "dateRange": {
            "startDate": "01/08/2025",
            "endDate": "27/08/2025"
          },
          "previewEnabled": true
        }
      }
    },
    "GET /api/bsi/accounts/:accountId/scraping": {
      "description": "Get scraping options for account",
      "response": {
        "success": true,
        "message": "Scraping options retrieved successfully",
        "data": {
          "id": 1,
          "accountId": 4,
          "isActive": true,
          "cronExpression": "0 */6 * * *",
          "browserType": "chrome",
          "maxRetries": 3,
          "lastStatus": "success",
          "lastRun": "2025-08-27T08:58:59.000Z"
        }
      }
    },
    "PUT /api/bsi/accounts/:accountId/scraping": {
      "description": "Update scraping options",
      "body": {
        "isActive": true,
        "cronExpression": "0 */4 * * *",
        "browserType": "chrome",
        "maxRetries": 5
      },
      "response": {
        "success": true,
        "message": "Scraping options updated successfully",
         "data": {
           "id": 1,
           "accountId": 4,
           "isActive": true,
           "cronExpression": "0 */4 * * *"
         }
       }
     },
     "GET /api/banks": {
       "description": "Get all active banks",
       "response": {
         "success": true,
         "message": "Banks retrieved successfully",
         "data": {
           "banks": [
             {
               "id": 1,
               "code": "BSI",
               "name": "BSI",
               "fullName": "Bank Syariah Indonesia",
               "country": "ID",
               "currency": "IDR",
               "logoUrl": "/images/banks/bsi.png",
               "websiteUrl": "https://www.bsi.co.id",
               "supportedFeatures": {
                 "scraping": true,
                 "realtime": false,
                 "api": false
               },
               "configuration": {
                 "loginUrl": "https://bsinet.bsi.co.id",
                 "timeout": 30000
               },
               "isActive": true,
               "createdAt": "2024-01-01T00:00:00.000Z",
               "updatedAt": "2024-01-01T00:00:00.000Z"
             }
           ]
         }
       }
     },
     "POST /api/banks": {
       "description": "Create new bank (admin only)",
       "permissions": ["banks.manage"],
       "body": {
         "code": "BCA",
         "name": "BCA",
         "fullName": "Bank Central Asia",
         "country": "ID",
         "currency": "IDR",
         "logoUrl": "/images/banks/bca.png",
         "websiteUrl": "https://www.bca.co.id",
         "supportedFeatures": {
           "scraping": true,
           "realtime": false,
           "api": false
         },
         "configuration": {
           "loginUrl": "https://ib.bca.co.id",
           "timeout": 30000
         }
       },
       "response": {
         "success": true,
         "message": "Bank created successfully",
         "data": {
           "bank": {
             "id": 2,
             "code": "BCA",
             "name": "BCA",
             "fullName": "Bank Central Asia",
             "country": "ID",
             "currency": "IDR",
             "logoUrl": "/images/banks/bca.png",
             "websiteUrl": "https://www.bca.co.id",
             "supportedFeatures": {
               "scraping": true,
               "realtime": false,
               "api": false
             },
             "configuration": {
               "loginUrl": "https://ib.bca.co.id",
               "timeout": 30000
             },
             "isActive": true
           }
         }
       }
     },
     "PUT /api/banks/:id": {
       "description": "Update bank (admin only)",
       "permissions": ["banks.manage"],
       "body": {
         "code": "BCA_UPDATED",
         "name": "BCA Updated",
         "fullName": "Bank Central Asia Updated",
         "supportedFeatures": {
           "scraping": true,
           "realtime": true,
           "api": false
         }
       },
       "response": {
         "success": true,
         "message": "Bank updated successfully",
         "data": {
           "bank": {
             "id": 2,
             "code": "BCA_UPDATED",
             "name": "BCA Updated",
             "fullName": "Bank Central Asia Updated",
             "supportedFeatures": {
               "scraping": true,
               "realtime": true,
               "api": false
             }
           }
         }
       }
     },
     "DELETE /api/banks/:id": {
       "description": "Delete bank (admin only)",
       "permissions": ["banks.manage"],
       "response": {
         "success": true,
         "message": "Bank deleted successfully"
       }
     },
     "GET /api/banks/all": {
       "description": "Get all banks including inactive ones (admin only)",
       "permissions": ["banks.manage"],
       "response": {
         "success": true,
         "message": "All banks retrieved successfully",
         "data": {
           "banks": [
             {
               "id": 1,
               "code": "BSI",
               "name": "BSI",
               "fullName": "Bank Syariah Indonesia",
               "isActive": true
             },
             {
               "id": 2,
               "code": "BCA",
               "name": "BCA",
               "fullName": "Bank Central Asia",
               "isActive": false
             }
           ]
         }
       }
     }
   },
  "socketExamples": {
    "sync_started": {
      "syncId": "sync_4_1724752156",
      "accountId": 4,
      "timestamp": "2025-08-27T09:04:01.536Z",
      "message": "Starting sync for account 4"
    },
    "sync_progress": {
      "syncId": "sync_4_1724752156", 
      "timestamp": "2025-08-27T09:04:01.536Z",
      "message": "ðŸš€ Initializing Chrome browser..."
    },
    "sync_completed": {
      "syncId": "sync_4_1724752156",
      "timestamp": "2025-08-27T09:04:01.536Z",
      "message": "Sync completed. New: 25, Existing: 10, Errors: 0",
      "success": true,
      "data": {
        "newCount": 25,
        "existingCount": 10,
        "errorCount": 0
      }
    },
    "automation_preview": {
      "syncId": "sync_4_1724752156",
      "timestamp": "2025-08-27T09:04:01.536Z",
      "message": "Screenshot captured",
      "image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
    },
    "batch_sync_progress": {
      "syncId": "batch_sync_1724752156",
      "timestamp": "2025-08-27T09:04:01.536Z",
      "message": "Processing account 1 (2/5)",
      "progress": {
        "current": 2,
        "total": 5,
        "percentage": 40
      }
    }
  },
  "errors": {
    "401": {
      "success": false,
      "message": "Authorization header missing"
    },
    "403": {
      "success": false,
      "message": "Insufficient permissions"
    },
    "404": {
      "success": false,
      "message": "Resource not found"
    },
    "409": {
      "success": false,
      "message": "User with this email already exists"
    },
    "500": {
      "success": false,
      "message": "Internal server error"
    }
  }
}